ё[{{:uplevel.png?direct&20|}}](home)
[{{:flag_rus.png?direct&20|}}](contents_rus)
[{{:flag_eng.png?direct&20|}}](contents_eng)

====== Модуль расширения Queen UniSense ver2 ======

**//Queen UniSense//** — плата для управления электрическими объектами и для получения информации с различных датчиков. Может выступать в качестве модуля расширения при нехватке входов-выходов платы //**[[queen_board_rus|Queen Board]]**//, а также в качестве самостоятельного устройства для гаджетов со множеством датчиков, управляемых компонентов и необходимостью воспроизведения звуковых эффектов. Обмен данными с платой осуществляется по интерфейсу //RS-485//, причём одного преобразователя //RS-485// в //Ethernet// достаточно для 16-ю платами //Queen UniSense//. Для взаимодействия с одной платой //**[[queen_board_rus|Queen Board]]**// и группой устройств на шине //RS-485// рекомендуется использовать преобразователь **//[[hw_setup_usr_tcp232_410s_rus|USR-TCP232-410S]]//**.

{{ :photo:queen-unisense-ver2.jpg?nolink&400 |}}

===== 1. Техническое описание платы Queen UniSense =====

Плата Queen UniSense обладает следующими техническим характеристиками:
  * напряжение питания — 12VDC;
  * габариты платы — ;
  * интерфейс rs485. Драйвер //MAX485// является съёмным, и может быть заменён в случае выхода из строя;
  * 8 выходов для подключения светодиодных лент, электромагнитных замков или иных устройств с напряжением питания не более 24VDC. Для управления яркостью светодиодных лент возможно применение ШИМ. Максимальный ток одного канала 5A, а максимальный суммарный ток всех каналов 10A. Выходы оснащены защитным диодом, подключаемым с помощью перемычки;
  * 8 дискретных входов с индикацией, иимеющих возможность работать в тестовом режиме, режиме "сухого" контакта, общего коллектора или общего эммитера (выбор режима осуществляется с помощью перемычек);
  * 4 канала АЦП с регулировочными потенциометрами;
  * воспроизведение звуков с microSD-карты;
  * слот для //Arduino Nano//. Выходы //Arduino Nano// выведены на клеммные колодки. Обмен данными между //Queen UniSense// и //Arduino Nano// осуществляется по //UART//;
  * выбор идентификатора платы и режима работы при помощи //DIP//-переключателей на плате без необходимости прошивки;
  * ISP-разъём для прошивки встроенного микроконтроллера //ATmega2560//.

{{ :photo:queen-unisense-ver2-legend.png?direct&400 |}}

===== 2. Подключение =====

Для работы платы необходимо постоянное напряжение 12 V. Определить необходимое сечения кабеля, которым плата подключается к источнику питания, можно с помощью статьи **[[reqs_cable_cut_rus|Оценка параметров кабелей]]**, учитывая, что максимальная потребляемая мощность для //Queen UniSense// будет около 120 W. Питание осуществляется через соответствующие клеммные зажимы, указанные на изображении ниже:
 
{{ :photo:queen-unisense-ver2-power.png?direct&400 |}}

Для соединения платы с преобразователем //RS-485// в //Ethernet// потребуется кабель //FТP/UTP//. Важно использовать жилы из одной пары. Клеммные зажимы //A// и //B// платы //Queen UniSense// соединяются с соответствующими выходами преобразователя. Соединять //GND// преобразователя и платы не обязательно. Расположение портов //A// и //B// показано на изображении ниже:
 
{{ :photo:queen-unisense-ver2-rs485.png?direct&400 |}}

===== 3. Arduino Nano в составе Queen UniSense =====

{{ :photo:queen-unisense-ver2-nano.jpg?nolink&400 |}}

С целью расширения базового функционала платы в специальный слот может подключаться микроконтроллер //Arduino Nano//. Для коммуникации с //Queen UniSense// используется аппаратный //UART//. Порты //Arduino Nano// для удобства выведены на клеммники, соответствие клеммных зажимов и портов //Arduino// приведено на изображении ниже:

{{ :photo:queen-unisense-ver2-arduinoscrew.png?direct&400 |}}

===== 4. Режимы работы платы Queen UniSense =====

==== 4.1. Автономный режим работы ====

В автономном режиме работы данные по интерфейсу //RS-485// не передаются, для функционирования платы достаточно только питания и установленного микроконтроллера //Arduino Nano//. Для работы в данном режиме на //DIP//-переключателе установить ключ //**№**// в позицию **//ON//**:

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/19 12:57// Здесь показывается DIP-переключатель, обведён нужный из ключей и ключ переведён в нужное положение

При использовании данной программы вся логика работы гаджета реализуется на микроконтроллере //Arduino Nano//, который имеет возможность по интерфейсу UART управлять выходами и получать информацию о состоянии входов.

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/19 12:57// Далее, наверное, следует придумать какие-то примеры работы, пару готовых прошивок, демонстрирующих данный режим

==== 4.2. Режим работы онлайн ====

Работа в режиме онлайн осуществляется, когда на //DIP//-переключателе ключ //**№**// установлен в позицию **//OFF//**:

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/19 12:57// Здесь показывается DIP-переключатель, обведён нужный из ключей и ключ переведён в нужное положение

При выборе онлайн-режима управление выходами и контроль состояния входов осуществляется при помощи программы управления //Queen Room//. Также опционально можно добавить передачу или приём каких-либо данных из //Arduino Nano//. 

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/19 12:57//Нужно будет написать несколько прошивок для наиболее популярных устройств, которыми нельзя управлять напрямую с юнисенса, например для адресной ленты, сервопривода, матричной клавиатуры

===== 5. Режимы работы дискретных входов =====

Выбор режима работы каждого дискретного входа выбирается индивидуально и осуществляется с помощью установки перемычек на группы контактов, расположенные рядом с каждым входом:

{{ :photo:queen-unisense-ver2-dinjumpers.png?nolink&400 |}}

==== 5.1. Тестовый режим ====

Для включения тестового режима требуется установить перемычки в следующее положение:

{{ :layout:unisense-mode-1.png?nolink |}}

Тестовый режим служит для проверки работы дискретных входов. В данном режиме имитируется то состояние, когда на вход поступил сигнал с датчика. Если снята хотя бы одна перемычка, то сигнал отсутствует. 

==== 5.2. Режим сухого контакта ====

Для режима сухого контакта перемычки должны быть установлены следующим образом:

{{ :layout:unisense-mode-2.png?nolink |}}

Данный режим подходит для подключения различных пассивных датчиков: кнопок, галетных переключателей, тумблеров, герконов, концевых переключателей и т.д.

==== 5.3. Режим общего коллектора ====

При работе в режиме общего коллектора положение перемычек такое:

{{ :layout:unisense-mode-3.png?nolink |}}

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/20 09:46//Примеры!

==== 5.4. Режим общего эмиттера ====

Выбор режима общего эмиттера осуществляется при следующем положение перемычек:

{{ :layout:unisense-mode-4.png?nolink |}}

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/20 09:46//Примеры!

===== 6. Режимы работы выходов =====

Рядом с каждым выходом есть пара контактов, которая позволяет выбрать режим работы выхода:

{{ :photo:queen-unisense-ver2-outjumpers.png?nolink&400 |}}

==== 6.1. Без защиты ====

При снятой перемычке защита с помощью встроенного диода отключена. В таком режиме допускается подключение светодиодных лент.

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/20 10:07//а здесь уже фото под углом, показана одна из пар контактов со снятой перемычкой

==== 6.2. С защитой при помощи встроенного диода ====

Для подключения защитного диода перемычку необходимо установить. Подключение электромагнитных замков и электромагнитных защёлок должно производиться исключительно с включенной защитой, иначе возможен выход из строя элементов платы.

 --- //[[alexchiga@ya.ru|Alexey Chigirenkov]] 2019/02/20 10:07//такое же фото, как и предыдущее, перемычка установлена


===== 7. Воспроизведение звука =====

С помощью платы //Queen UniSense// возможно воспроизведение звука с //microSD//. Воспроизведение звука осуществляется с помощью установленного на плате модуля //mp3//-плеера:

{{ :photo:queen-unisense-ver2-mp3.png?nolink&400 |}}

К плате может быть подключена как и активная акустическая стереосистема (R, L, GND), так и обычный динамик мощностью до 3W (SPK1, SPK2). Выходы плеера выведены на клеммные колодки:

{{ :photo:queen-unisense-ver2-mp3screw.png?direct&400 |}}

Все необходимые звуки записываются на //microSD//-карту. Максимально количество треков: 255. Формат: //mp3//. Все файлы должны иметь имена в следующем виде: "001.mp3", "002.mp3", ..., "255.mp3".