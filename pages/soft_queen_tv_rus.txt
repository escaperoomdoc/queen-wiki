[{{:uplevel.png?direct&20|}}](contents_rus)
[{{:flag_rus.png?direct&20|}}](soft_queen_tv_rus)
[{{:flag_eng.png?direct&20|}}](soft_queen_tv_eng)

====== Средство управления экранами queen_tv ======

В состав системы **queen** входит специальная программа **queen\_tv**, разработанная под Windows и Raspberry Pi 3 и распространяемая бесплатно.  

===== Перечень оборудования =====  

| **устройство**             | **фото**                      | **комментарии, требования, модель** |
| 1. **Сетевой фильтр**      |  {{:photo:power-strip-2.jpg?direct&100|}} | |
| 2. **Процессорный модуль** |  |  |
| 2.1. Raspberry Pi          | {{:photo:raspberry_pi_3_1.jpg?direct&200|}} | модель : raspberry pi 3 model B |
| 2.2. micro-SD card         | {{ :photo:microsd-1.jpg?direct&40 |}} | SD-карта для RPI, class 10, 8GB |
| 2.3. RPI адаптер питания   | {{ :photo:ac_dc_adapter_1.jpg?direct&60 |}} | адаптер питания для raspberry pi, 5V, 2-3A, microUSB |
| 3. **Дисплей**             | {{:photo:tv_1.jpg?direct&200|}} | Дисплей должен иметь HDMI-интерфейс |


===== Подготовка raspberry pi =====  

Необходимо подготовить raspberry pi. Для этого сначала нужно загрузить операционную систему, используя **[инструкцию по заливке образа](rpi_image_upload_rus)**, а затем установить нужный IP адрес сети, используя **[эту инструкцию](rpi_ip_setup_rus)**. После этого следует скопировать в папку **/home/pi/queen/queen\_tv** последнюю версию программы **queen\_tv**, используя **[инструкцию по загрузке программ](rpi_soft_install_rus)**, только заливать будем программу **queen\_tv** и необходимые видео файлы.


===== Общие сведения =====

Компьютер с **queen\_tv** подключается с дисплею и интегрируется с гейм-менеджером **queen\_room** посредством локальной вычислительной сети LAN по WiFi/Ethernet.  Компонент **queen\_tv** позволяет:  
- проигрывать видеофайлы с возможностью зацикливания;  
- устанавливать картинку / заставку / заданный цвет фона;  
- отображать таймер хода игры;  
- показывать подсказки в виде печатного текста;  


Структура экрана **queen\_tv**:  
{{:layout:queen_tv_layout_1.png|}}


**HEAD** - место для заголовка (например логотипа компании или названия квеста);  
**TIME** - место для таймера;  
**CLUE** - место для подсказки;  


Программа **queen\_tv** может находится в двух взаимоисключающих состояниях: проигрывания видео на весь экран (видео режим) или в состоянии отображения текстового контента (текстовый режим).


===== Установка queen_tv =====

Далее необходимо скопировать программу queen tv на raspberry pi. Для этого создайте папку **queen\_tv** в домашней папке **(/home/pi)** и скопируйте туда программу **queen\_tv** и файл typing.mp3. Используйте **[инструкцию по копированию](rpi_ftp_ssh_setup_rus)**. Потом скопируйте в эту же папку все необходимые видеофайлы и нужные картинки в **формате PNG**.  


Далее необходимо установить атрибут файла **queen\_tv** для возможности запуска. Для этого нужно правой кнопкой мыши кликнуть по файлу и в меню выбрать “Properties”. Перейти на вкладку “Permissions” открывшегося диалога “File properties” и установить Execute = Anyone, затем нажать “Enter”:  
![](:screen:rpi_fileprops.jpg)  


Для проигрывания видео создайте в queen\_studio компонент типа "adapter" и установите у него hwtype=tv, а в качестве IP адреса нужно указать IP адрес raspberry, на котором будет запущен queen\_tv, port=4466. Далее, запустив queen room, нужно убедиться, что связь с queen tv установилась (адаптер стал зеленым), и двойным кликом вызвать меню, зайти в подменю "play" и выбрать нужный файл для проигрывания (видео файлы файлы должны быть скопированы заранее и формат должен быть совместимым - смотрите в конце статьи информацию об этом).  


===== Команды queen_tv =====

Некоторые команды, такие как проиграть видео или дать подсказку можно выпонлить в ручном режиме из интерфейса гейммастера в queen\_room, но в действительности список команд управления намного больше и он задается через макроэффекты. Для этого необходимо в макроэффекта выбрать действие **send**, выбрать adapter, который связан с queen_tv и ввести любую из следующих команд (ключевые слова выделены жирным) :  


**Работа с видео**:  
| **Команда**      | **Описание**  |
| **play** "video.avi"   | перейти в видео режим и проиграть файл video.avi |
| **play** "video.avi" **loop**  | перейти в видео режим и проиграть файл video.avi и зациклить проигрывание |
| **stop**             | выйти из в видео режима и остановить проигрывание файла |
| **pause**            | поставить проигрывание файла на паузу |  
также программа выходит из видео режима автоматически после окончания проигрывания видеофайла, если не указан флаг зацикливания.  


**Работа с контентом**:  
| **Команда....................**           | **Описание**  |
| **head** "text"           | вывести text в зоне заголовка HEAD |
| **time** on               | показать оставшееся время квеста в зоне таймера TIME |
| **time** off              | скрыть оставшееся время квеста в зоне таймера TIME |
| **clue** "text"           | вывести text в зону подсказок CLUE |
| **clue** "text" **typing**    | вывести text в зону подсказок CLUE побуквенно  |
| **clue** "text" **typingfx** | вывести text в зону подсказок CLUE побуквенно со звуком печатающей машинки |
| **textcolor** newcolor    | установить цвет newcolor во всех зонах (HEAD,TIME,CLUE), причем newcolor может быть как человечески понятным, например, red, green, yellow, и т.д., так и выраженный в HEX-формате RGB, начиная с символа #, так же как в CSS, например #ff0000 - красный, #00ff00 - зеленый, #ffffff - белый и т.д. |
| **headcolor** newcolor    | установить цвет newcolor в зоне заголовка HEAD, формат newcolor см.выше |
| **timecolor** newcolor    | установить цвет newcolor в зоне таймера TIME, формат newcolor см.выше |
| **cluecolor** newcolor    | установить цвет newcolor в зоне подсказок CLUE, формат newcolor см.выше |
| **color** newcolor        | установить цвет newcolor в качестве фона, формат newcolor см.выше |
| **textsize** size         | установить размер текста size во всех зонах (HEAD,TIME,CLUE), size - это число от 1 до 72  |
| **headsize** size         | установить размер текста size в зоне заголовка HEAD, формат size см.выше |
| **timesize** size         | установить размер текста size в зоне таймера TIME, формат size см.выше |
| **cluesize** size         | установить размер текста size в зоне подсказок CLUE, формат size см.выше |
| **font** "newfont"        | установить шрифт текста font во всех зонах (HEAD,TIME,CLUE), newfont - это семейство шрифта, например, "Arial", "Times New Roman", "Corier New" и т.д. |
| **image** "bg.png"         | установить картинку backgroud.png в качестве фона, разместив ее относительно левого верхнего угла |
| **image** "bg.png" **stretch** | установить картинку backgroud.png в качестве фона, растянув ее по всей площади экрана |

**Очень важно!!!**  
1. В командах, где это указано, необходимо использовать именно двойные кавычки, а не одинарные.  
2. В команде image используйте только PNG файлы (jpg не поддерживается).  
3. Для Raspberry Pi: при проигрывании видео файлов поток пишется напрямую в видеопамять для ускорения процесса, поэтому его не будет видно через удаленный рабочий стол VNC, хотя на телевизоре через HDMI все будет проигрываться нормально.  
4. Для Raspberry Pi: мы рекоммендуем проигрывать видео только в формате MP4 с кодеком H.264.  
5. Для Windows: мы рекоммендуем устанавливать последнюю версию K-Lite Codec Pack при использовании queen tv.
6. Для Windows: обнаружена проблема: в некоторых случаях видео даже при установленных кодеках не проигрывается, есть временное решение - это установить библиотеку [Qt](https://1drv.ms/u/s!Am_hkdn5bouSgp5ygnMihG-atZ9zvQ) в C:/qt/4.7.4/bin, удалить все dll из папки с queen tv, прописать в системный Path этот путь C:/qt/4.7.4/bin, после чего нужно перезагрузить компьютер и все будет работать. В ближайшее время мы устраним этот issue и релиз queen будет включать "в коробке" все необходимы компоненты без внешних библиотек и зависимостей.  


